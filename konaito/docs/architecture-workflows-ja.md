# メールアドレスにクリプトを送る世界：高レベル設計とワークフロー（技術難易度は一旦無視）

本書は、「メールアドレス宛にステーブルコイン等を送金できる」体験を、専門用語や実装難易度をできるだけ排して説明する高レベル設計です。

## 前提と原則
- メールアドレスが“支払いの宛先”として機能する。
- 受取側がまだウォレットを持っていなくても受け取れる。
- 手数料や鍵管理などの専門知識を意識させない（ガスレス体験）。
- 送金の作成～受取～完了まで、リンクとメール通知で直感的に操作できる。

## 主要な登場人物と役割
- 送金者（Sender）: メールを知っている相手へクリプトを送りたい人/企業。
- 受取者（Receiver）: メールを受け取り、リンクから簡単に受け取る人/企業。
- ウォレットサービス（Wallet Service）: 受取のためのアカウント作成/管理を裏側でサポート。
- 送金プラットフォーム（Platform）: 送金の作成・通知・状態管理・返金等を司る中枢（Web/モバイル）。
- ブロックチェーン台帳（Ledger）: 送金が確定すると残高が移動する“公的な記録簿”。
- 通知チャネル（Email/Link）: ユーザーは主にメールの通知とリンク操作で完結。

## アーキテクチャ（概念）
- フロント: 送金画面・受取画面（どちらもWebリンクで開ける）。
- プラットフォーム: 送金の記録、状態管理、通知送信、返金/期限切れ処理を担当。
- ウォレット: 受取時に自動で用意（未保有なら初回セットアップ）。
- 台帳: 送金が確定したら残高が動く。すべての最終記録はここ。

イメージ: Sender → [Platformに送金依頼] → PlatformがReceiverにリンク通知 → Receiverがリンクで受取 → Platformが台帳へ確定記録。

## ワークフロー（ハッピーパス）
1) 送金の作成
- 送金者は受取人のメールアドレスと金額を入力して「送る」を押す。
- プラットフォームは「この送金」を一意に識別するIDを発行し、受取リンクを生成。

2) 通知と待機
- 受取者のメールに「あなた宛に送金があります」という通知と受取リンクが届く。
- 送金は「未受取」の状態で安全に保留される（資金はエスクロー的に確保）。

3) 受取
- 受取者はリンクを開き、案内に従って受取をタップ（初回は簡単なセットアップ）。
- プラットフォームは受取者のアカウントに紐づけ、台帳に送金確定を記録。

4) 完了
- 両者に完了メールが届き、受取者の残高が更新される。

## ウォレット保有状況による分岐
- 既にウォレットを持つ受取者: リンクで同意→即時に残高加算。
- まだ持っていない受取者: 初回リンクで“簡単なセットアップ”→そのまま受取完了。

## うまくいかなかった場合の分岐
- 間違ったメールアドレスに送った
  - 受取前: 送金者は「取消」を押して資金を自分に戻せる。
  - 受取後: 通常は受取者の同意が必要。間違い申告はサポート経由で調整。
- 受取期限が過ぎた
  - プラットフォームが自動で送金を失効にし、送金者へ返金。
- 受取者が拒否した
  - ステータスは「拒否」になり、送金者へ返金。

## 企業ユース（請求・一括ペイアウト）
- 請求（Request to Pay）
  - 事業者がメールで請求を送る→支払者はリンクから承認→台帳記録→請求消込が自動で一致。
- 一括ペイアウト
  - 事業者はCSVでメールと金額を登録→一斉に受取リンクが送信→各受取者がリンクで受取。

## 資金の扱いモデル（わかりやすさ優先）
- 推奨: エスクロー方式
  - 受取者がリンクで受け取るまで資金はプラットフォーム側で保留。
  - メリット: 間違い/期限切れ/拒否時に返金しやすい。ユーザーが混乱しにくい。
- 代替: 先に“受取人用の箱”に着金させる方式
  - メリット: 即時着金感。
  - デメリット: 間違い時の取り回しが複雑になるため、初期は非推奨。

## ステータスの見える化（例）
- Created（作成済み/未通知）
- Notified（通知済み/未受取）
- Claimed（受取済み）
- Refused（受取拒否）
- Expired（期限切れ返金）
- Refunded（返金済み）

## 画面・メールの文面イメージ
- 通知メール（受取者向け）
  - 件名: 「◯◯さんから送金が届いています」
  - 本文: 金額/通貨/メモ、受取期限、受取ボタン
- 受取画面
  - 1行説明→金額/送金者→受取ボタン→完了メッセージ
- 送金者画面
  - ステータス一覧（未受取/受取済/期限切れ/返金済）と取消ボタン

## 安心・安全（技術詳細は省略）
- なりすまし/誤送金を防ぐため、送金前の確認画面と受取側での金額・送金者の明示。
- 高額時は追加確認（例: もう一度タップ、または2段階確認）。
- すべての送金に「有効期限」と「一意の番号（ノンス）」を付与して、再利用や放置を防ぐ。

## まとめ
- メールアドレスだけでクリプトをやり取りできる世界を、リンクとシンプルな画面で実現。
- 初期は「エスクロー方式」を採用し、間違い・拒否・期限切れへの安心な戻し口を用意。
- 事業者ユースは請求/一括配布をメールで完結。誰でも迷わず使える体験を最優先。
