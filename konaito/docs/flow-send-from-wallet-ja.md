# 体験フロー: Email Walletから資産を送る

このドキュメントは、ペルソナ3（Email Wallet User）が、自身のEmail Walletから他の宛先（別のアドレスやユーザー）へ資産を送金する際の、具体的な操作フローとその裏側の仕組みを解説します。

## 概要

ユーザーはEmail Walletアプリ上で送金内容を指示し、その結果として自動生成された「命令メール」を自身のメールクライアントから送信するだけで、安全に資産を移動させることができます。秘密鍵の管理や署名といった複雑な操作は一切不要です。

## 登場人物

- **ユーザー（送金者）**: Email Walletの所有者本人。
- **Email Walletアプリケーション**: ユーザーが操作するWebサイトやスマートフォンアプリ。
- **ユーザーのメールクライアント**: ユーザーが普段利用しているGmail、Outlookなどのメールソフト。
- **プラットフォームの受付サーバー**: ユーザーからの「命令メール」を受信し、検証・証明生成を行うシステム（リレー/プルーバー）。
- **スマートコントラクト**: ブロックチェーン上でユーザーの資産を管理し、正当な命令に基づいて資産を移動させるプログラム。

## 操作フロー（ユーザー視点）

ユーザーが体験する操作は、以下のシンプルで直感的なステップで完了します。

1.  **送金内容の入力**: ユーザーはEmail Walletアプリを開き、送金したい宛先のアドレス、資産の種類（例: ETH）、金額を入力して「送金内容の確認へ」といったボタンをタップします。

2.  **メール作成画面の表示**: アプリが `mailto:` リンクを生成・実行します。これにより、ユーザーが普段使っているメールクライアント（Gmailアプリなど）が自動的に起動し、**宛先・件名・本文がすべて入力されたメール作成画面**が表示されます。
    - **宛先**: `action@wallet.service.com` のような、プラットフォームの受付アドレスが自動で入ります。
    - **本文**: 「宛先 `0xabc...` へ `0.1 ETH` を送金」といった、操作内容が機械可読な形式で記述されます。

3.  **内容確認と送信**: ユーザーは、自動生成されたメールの内容が、自分の意図した操作と一致していることを確認し、**「送信」ボタンを押します**。これがユーザーが行う最後の操作です。

4.  **完了通知**: しばらくすると、Email Walletアプリやメールで、送金が正常に完了した旨の通知を受け取ります。

## 裏側の技術フロー（プラットフォーム視点）

ユーザーがメールを送信した後の、プラットフォームとブロックチェーン上での動きです。

1.  **「命令メール」の受信**: プラットフォームの受付サーバーは、ユーザーから送信されたメールを受信します。このメールには、ユーザーのメールサービスによって付与された**正規のDKIM署名**が含まれています。

2.  **検証と証明生成**: サーバーは、受信したメールのDKIM署名を検証し、「たしかに本物のユーザー `(例: user@example.com)` からの正当な操作命令である」ことを確認します。そして、この検証結果とメール本文の操作内容を元に、**ゼロ知識証明を生成**します。

3.  **スマートコントラクトの実行**: サーバーは、生成したゼロ知識証明をブロックチェーン上のスマートコントラクトに提出します。スマートコントラクトは、その証明が有効であることを検証した上で、ユーザーのウォレットからの資産移動を安全に実行します。

## まとめ

このアーキテクチャにより、ユーザーは秘密鍵を直接管理・操作する必要がなくなります。日常的に使い慣れた「メールを送信する」という行為が、ブロックチェーン上の資産を安全に操作するための「署名」の代わりとなるのです。
