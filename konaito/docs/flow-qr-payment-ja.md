# 体験フロー: QRコードによる店頭支払い

このドキュメントは、事業者（ペルソナ4）が提示したQRコードを、顧客（ペルソナ3）が読み取って支払いを行う体験フローを解説します。これにより、専用の決済端末なしに、スマートフォンだけで暗号資産決済を実現します。

## 登場人物
- **事業者（ペルソナ4）**: 支払いを受け付けたい店主など。自身のスマートフォンやタブレットに「請求アプリ」をインストールしている。
- **顧客（ペルソナ3）**: Email Walletユーザー。自身のスマートフォンに標準のカメラとメールクライアント（Gmailなど）が入っている。
- **請求アプリ**: 事業者が金額を入力し、決済用のQRコードを生成するためのアプリケーション。
- **プラットフォーム**: メールを検証し、ブロックチェーン上の決済を実行するバックエンドシステム。

## 支払いフロー

### 1. 請求額の入力とQRコード生成
- **事業者**: 請求アプリを開き、顧客に請求する金額（例: `15 USDC`）と任意のメモ（例: `コーヒーとサンドイッチ`）を入力し、「決済用QRを作成」ボタンをタップします。
- **請求アプリ**: アプリは、支払い内容を含む `mailto:` リンクを即座に生成し、それを画面上にQRコードとして表示します。
    - `mailto:` リンクの内容（例）:
        - **宛先**: `pay@wallet.service.com` （プラットフォームの受付アドレス）
        - **件名**: `Payment Request #12345`
        - **本文**: `recipient=merchant-wallet-address&amount=15&token=USDC&memo=...`

### 2. QRコードの読み取りとメール送信
- **顧客**: スマートフォンのカメラで、事業者の画面に表示されたQRコードを読み取ります。
- **顧客のスマートフォン**: OSがQRコード内の `mailto:` リンクを認識し、自動的に標準のメールクライアント（Gmailなど）を起動します。宛先、件名、本文がすべて入力されたメール作成画面が立ち上がります。
- **顧客**: メールに記載された支払先や金額が正しいことを確認し、**「送信」ボタンをタップします。** これが支払いの「承認」行為となります。

### 3. 決済の実行と完了確認
- **プラットフォーム**: 顧客から送信された「支払い命令メール」を受信し、DKIM署名を検証して、正当な操作であることを確認します。その後、ゼロ知識証明を生成し、ブロックチェーン上で顧客のウォレットから事業者のウォレットへの資産移動を実行します。
- **事業者**: 自身の請求アプリの画面が、リアルタイムで「支払い完了」の表示に切り替わります。これにより、商品を顧客に渡せることが確認できます。
- **顧客**: 自身のEmail Walletの取引履歴に、今しがたの支払い記録が即座に反映されます。

## このフローの利点

- **事業者にとって**: 高価な専用決済端末やカードリーダーは一切不要です。スマートフォンやタブレット一つで、低コストかつ手軽に暗号資産決済を導入できます。
- **顧客にとって**: 新たな決済アプリをインストールする必要がありません。標準のカメラとメールソフトだけで、QRコードを読み取ってメールを送る、という直感的で安全な支払い体験ができます。
