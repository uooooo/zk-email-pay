## 技術解説: 送金受取フローの裏側

このドキュメントは `flow-send-eth-to-3-ja.md` で描かれたシンプルな送金受取体験の裏側で、どのような技術的な処理が行われているかを解説します。

## 登場人物（技術視点）

*   **ユーザー（受取人）**: ブラウザを通じてプラットフォームを操作する人。
*   **プラットフォーム・フロントエンド**: ユーザーが直接操作するWebサイトの画面。
*   **プラットフォーム・バックエンド**: ユーザーからのリクエストを処理し、証明生成などを行うサーバー。「プルーバー」としての役割を担います。
*   **検証スマートコントラクト**: ブロックチェーン上に配備された、ゼロ知識証明を検証するプログラム。「ヴェリファイア」としての役割を担います。
*   **エスクローコントラクト**: 送金された資金を一時的に保管（ロック）するスマートコントラクト。

## 処理フローの詳細

ユーザーが「受け取る」ボタンをタップしてから、資金がウォレットに届くまでの流れです。

### ステップ1: トリガー（ユーザーのアクション）

すべての処理は、ユーザーのアクションから始まります。

1.  受取人は、通知メールに記載された「受取リンク」を開きます。
2.  表示されたWebページ（プラットフォーム・フロントエンド）で、送金内容を確認し**「受け取る」ボタンをタップ**します。
3.  このタップ操作が、プラットフォーム・バックエンドに対して「この送金を受け取りたい」というAPIリクエストを送信します。これが全体の処理が発火する引き金です。

### ステップ2: 証明生成（プラットフォームの役割）

リクエストを受け取ったプラットフォーム・バックエンドは、「プルーバー」としてゼロ知識証明を生成します。

*   **証明する内容**: バックエンドは、以下の複数の事実を暗号学的に結合し、単一の「証明」を作成します。
    *   **事実A**: 私（プラットフォーム）は、正規のDKIM署名がついた通知メールを、指定された受取人に確かに送信しました。
    *   **事実B**: そのメールには、この送金ID、金額、送金者、受取人の情報が正確に含まれていました。
    *   **事実C**: そして今、そのメールを受け取った本人から、正当なWebサイト経由で「受け取る」という明確な意思表示がありました。

このプロセスにより、オフチェーンの出来事（メール送信やWebサイトでのクリック）が、ブロックチェーン上で検証可能な形式に変換されます。

### ステップ3: 検証（検証スマートコントラクトの役割）

プラットフォーム・バックエンドは、生成したゼロ知識証明をブロックチェーン上の「検証スマートコントラクト」に提出します。

*   検証スマートコントラクトの仕事はただ一つ、**「提出された証明が、ステップ2で述べた全ての事実を本当に証明しているか」**を数学的に検証することです。
*   この検証は、証明以外の情報（元のメール内容など）を一切必要としないため、「ゼロ知識」と呼ばれます。

### ステップ4: 実行（エスクローからの資金解放）

証明が有効であると確認されると、最終的なアクションが実行されます。

1.  検証スマートコントラクトは、隣の「エスクローコントラクト」に対して「この送金の受け取りは正当である」と通知（関数を呼び出し）します。
2.  この通知を受けたエスクローコントラクトは、命令に従い、ロックしていた資金（ETH）を**受取人のウォレットアドレスに送金**します。

これにより、一連の送金プロセスが安全に完了します。

## まとめ

このように、シンプルな「受け取る」ボタンの裏側では、プラットフォームが証明生成の役割を代行し、スマートコントラクトがそれを厳密に検証することで、ユーザーに複雑さを感じさせない、安全な資金移動が実現されています。