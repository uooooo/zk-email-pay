# ZK Email Pay - æŠ€è¡“è©³ç´°è§£èª¬

## ğŸ”§ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰   â”‚    ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼     â”‚  ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³  â”‚
â”‚                 â”‚                 â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ãƒ•ã‚©ãƒ¼ã‚»ãƒƒãƒˆ   â”‚ â”‚ â”‚ãƒ¡ãƒ¼ãƒ«        â”‚ â”‚ â”‚EmailWallet  â”‚ â”‚
â”‚ â”‚ãƒšãƒ¼ã‚¸        â”‚ â”‚ â”‚ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼   â”‚ â”‚ â”‚Core         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚                 â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚é€é‡‘ãƒšãƒ¼ã‚¸     â”‚ â”‚ â”‚ZKè¨¼æ˜        â”‚ â”‚ â”‚UnclaimedFundâ”‚ â”‚
â”‚ â”‚             â”‚ â”‚ â”‚ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿   â”‚ â”‚ â”‚Manager      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚                 â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ã‚¢ãƒ‰ãƒ¬ã‚¹      â”‚ â”‚ â”‚ã‚¬ã‚¹ä»£        â”‚ â”‚ â”‚ERC20        â”‚ â”‚
â”‚ â”‚ã‚¦ã‚©ãƒ¬ãƒƒãƒˆ    â”‚ â”‚ â”‚ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼     â”‚ â”‚ â”‚ãƒˆãƒ¼ã‚¯ãƒ³      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ã‚¼ãƒ­çŸ¥è­˜è¨¼æ˜ã‚·ã‚¹ãƒ†ãƒ 

### DKIMç½²åæ¤œè¨¼ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¡ãƒ¼ãƒ«é€ä¿¡
   â†“
   ğŸ“§ [DKIM-Signature: v=1; a=rsa-sha256; d=gmail.com...]
   
2. ZKå›è·¯å…¥åŠ›
   â†“
   ğŸ” {
      email_header: "...",
      signature: "...",
      public_key: "...",
      body_hash: "..."
   }
   
3. å›è·¯æ¤œè¨¼
   â†“
   âš¡ è¨¼æ˜: "ã“ã®ãƒ¡ãƒ¼ãƒ«ãŒgmail.comã«ã‚ˆã£ã¦ç½²åã•ã‚ŒãŸã“ã¨ã‚’å†…å®¹ã‚’æ˜ã‹ã•ãšã«è¨¼æ˜"
   
4. zk-SNARKç”Ÿæˆ
   â†“
   ğŸ¯ å‡ºåŠ›: ã‚¼ãƒ­çŸ¥è­˜è¨¼æ˜ + ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚·ã‚°ãƒŠãƒ«
   
5. ã‚ªãƒ³ãƒã‚§ãƒ¼ãƒ³æ¤œè¨¼
   â†“
   âœ… ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒç´„21,000ã‚¬ã‚¹ã§è¨¼æ˜ã‚’æ¤œè¨¼
```

### å›è·¯è¨­è¨ˆ

```rust
// ç°¡åŒ–ã•ã‚ŒãŸZKå›è·¯ãƒ­ã‚¸ãƒƒã‚¯
template EmailVerification() {
    // ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå…¥åŠ›ï¼ˆéå…¬é–‹ï¼‰
    signal private input email_header;
    signal private input email_body;
    signal private input signature;
    
    // ãƒ‘ãƒ–ãƒªãƒƒã‚¯å…¥åŠ›ï¼ˆã‚ªãƒ³ãƒã‚§ãƒ¼ãƒ³ã§å¯è¦–ï¼‰
    signal input sender_email_hash;
    signal input command_hash; // "confirm"ã®ãƒãƒƒã‚·ãƒ¥
    signal input amount;
    signal input recipient;
    
    // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    component rsa_verify = RSAVerify(2048);
    component email_parser = EmailParser();
    component command_extractor = CommandExtractor();
    
    // DKIMç½²åã‚’æ¤œè¨¼
    rsa_verify.message <== email_header;
    rsa_verify.signature <== signature;
    rsa_verify.public_key <== dkim_public_key;
    rsa_verify.valid === 1;
    
    // ã‚³ãƒãƒ³ãƒ‰ã‚’æŠ½å‡ºãƒ»æ¤œè¨¼
    command_extractor.email_body <== email_body;
    command_extractor.command_hash === command_hash;
    
    // é€ä¿¡è€…ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æ¤œè¨¼
    email_parser.header <== email_header;
    email_parser.sender_hash === sender_email_hash;
}
```

---

## â›“ ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚³ã‚¢ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ

#### 1. EmailWalletCore
```solidity
contract EmailWalletCore {
    struct EmailWallet {
        bytes32 emailHash;  // keccak256(email)
        address owner;      // ã‚¯ãƒ¬ãƒ¼ãƒ æ™‚ã«è¨­å®š
        uint256 nonce;      // ãƒªãƒ—ãƒ¬ã‚¤æ”»æ’ƒä¿è­·
        bool isActive;      // ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
    }
    
    mapping(bytes32 => EmailWallet) public wallets;
    mapping(bytes32 => bool) public nullifierHashes;
    
    function createEmailWallet(
        bytes32 emailHash,
        bytes32 accountCode
    ) external onlyRelayer {
        // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã§ã‚¦ã‚©ãƒ¬ãƒƒãƒˆä½œæˆ
        wallets[emailHash] = EmailWallet({
            emailHash: emailHash,
            owner: address(0),
            nonce: 0,
            isActive: true
        });
    }
    
    function executeEmailCommand(
        uint[2] calldata _pA,
        uint[2][2] calldata _pB,
        uint[2] calldata _pC,
        uint[4] calldata _pubSignals
    ) external onlyRelayer {
        // ZKè¨¼æ˜ã‚’æ¤œè¨¼
        require(verifyProof(_pA, _pB, _pC, _pubSignals), "Invalid proof");
        
        // ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚·ã‚°ãƒŠãƒ«ã‚’æŠ½å‡º
        bytes32 emailHash = bytes32(_pubSignals[0]);
        bytes32 commandHash = bytes32(_pubSignals[1]);
        uint256 amount = _pubSignals[2];
        address recipient = address(uint160(_pubSignals[3]));
        
        // ã‚³ãƒãƒ³ãƒ‰ã‚¿ã‚¤ãƒ—ã«åŸºã¥ã„ã¦å®Ÿè¡Œ
        if (commandHash == keccak256("confirm")) {
            _processTransfer(emailHash, recipient, amount);
        }
        // ... ãã®ä»–ã®ã‚³ãƒãƒ³ãƒ‰
    }
}
```

#### 2. UnclaimedFundManager
```solidity
contract UnclaimedFundManager {
    struct UnclaimedFund {
        address sender;
        bytes32 recipientEmailHash;
        address token;
        uint256 amount;
        uint256 expiryTime;
        bool claimed;
    }
    
    mapping(bytes32 => UnclaimedFund) public unclaimedFunds;
    
    function registerUnclaimedFund(
        bytes32 recipientEmailHash,
        address token,
        uint256 amount,
        uint256 expiryTime
    ) external payable {
        bytes32 id = keccak256(abi.encodePacked(
            msg.sender,
            recipientEmailHash,
            token,
            amount,
            block.timestamp
        ));
        
        // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã“ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«è»¢é€
        IERC20(token).transferFrom(msg.sender, address(this), amount);
        
        unclaimedFunds[id] = UnclaimedFund({
            sender: msg.sender,
            recipientEmailHash: recipientEmailHash,
            token: token,
            amount: amount,
            expiryTime: expiryTime,
            claimed: false
        });
        
        // ã‚¯ãƒ¬ãƒ¼ãƒ ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’é€ä¿¡
        emit ClaimEmailRequest(recipientEmailHash, id, amount, token);
    }
    
    function claimFund(
        bytes32 fundId,
        uint[2] calldata _pA,
        uint[2][2] calldata _pB,  
        uint[2] calldata _pC,
        uint[4] calldata _pubSignals
    ) external {
        UnclaimedFund storage fund = unclaimedFunds[fundId];
        require(!fund.claimed, "Already claimed");
        require(block.timestamp < fund.expiryTime, "Expired");
        
        // ãƒ¡ãƒ¼ãƒ«æ‰€æœ‰æ¨©ã®ZKè¨¼æ˜ã‚’æ¤œè¨¼
        require(verifyEmailProof(_pA, _pB, _pC, _pubSignals), "Invalid email proof");
        
        // å—ä¿¡è€…ã®ãƒ¡ãƒ¼ãƒ«ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã«è³‡é‡‘è»¢é€
        fund.claimed = true;
        IERC20(fund.token).transfer(_getEmailWalletAddress(_pubSignals[0]), fund.amount);
    }
}
```

---

## ğŸŒ ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚·ã‚¹ãƒ†ãƒ  ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
interface RelayerSystem {
  emailProcessor: EmailProcessor;
  zkProofGenerator: ZKProofGenerator;  
  gasManager: GasManager;
  transactionBroadcaster: TransactionBroadcaster;
}

class EmailProcessor {
  async processIncomingEmail(email: Email): Promise<EmailCommand> {
    // ãƒ¡ãƒ¼ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ãƒ‘ãƒ¼ã‚¹
    const dkimSignature = this.extractDKIMSignature(email.headers);
    const senderEmail = this.extractSender(email.headers);
    
    // ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ‘ãƒ¼ã‚¹
    const command = this.parseCommand(email.body);
    
    return {
      sender: senderEmail,
      command: command,
      dkimSignature: dkimSignature,
      timestamp: email.timestamp
    };
  }
  
  private parseCommand(body: string): Command {
    // ç‰¹å®šã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ¢ã™
    if (body.toLowerCase().includes('ç¢ºèª') || 
        body.toLowerCase().includes('confirm') ||
        body.toLowerCase().includes('ã¯ã„')) {
      return { type: 'CONFIRM', params: {} };
    }
    
    // é€é‡‘ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ‘ãƒ¼ã‚¹: "alice@example.comã«100USDCé€ã£ã¦"
    const sendMatch = body.match(/([^\s]+@[^\s]+)ã«(\d+\.?\d*)(\w+)é€/);
    if (sendMatch) {
      return {
        type: 'SEND',
        params: {
          recipient: sendMatch[1],
          amount: sendMatch[2],
          token: sendMatch[3]
        }
      };
    }
    
    return { type: 'UNKNOWN', params: {} };
  }
}

class ZKProofGenerator {
  async generateProof(emailCommand: EmailCommand): Promise<ZKProof> {
    // å›è·¯å…¥åŠ›ã‚’æº–å‚™
    const inputs = {
      email_header: emailCommand.dkimSignature.header,
      email_body: emailCommand.body,
      signature: emailCommand.dkimSignature.signature,
      sender_email_hash: keccak256(emailCommand.sender),
      command_hash: keccak256(emailCommand.command.type),
      // ... ãã®ä»–ã®å…¥åŠ›
    };
    
    // snarkjsã‚’ä½¿ç”¨ã—ã¦è¨¼æ˜ã‚’ç”Ÿæˆ
    const { proof, publicSignals } = await snarkjs.groth16.fullProve(
      inputs,
      this.circuitWasm,
      this.circuitZkey
    );
    
    return {
      proof: this.formatProofForSolidity(proof),
      publicSignals: publicSignals
    };
  }
}
```

### ã‚¬ã‚¹ä»£ç®¡ç†

```typescript
class GasManager {
  private gasPool: GasPool;
  
  async estimateTransactionCost(tx: Transaction): Promise<GasCost> {
    const provider = new ethers.providers.JsonRpcProvider(this.rpcUrl);
    
    // ã‚¬ã‚¹ã‚’è¦‹ç©ã‚‚ã‚Š
    const gasEstimate = await provider.estimateGas(tx);
    const gasPrice = await provider.getGasPrice();
    
    return {
      gasLimit: gasEstimate,
      gasPrice: gasPrice,
      totalCost: gasEstimate.mul(gasPrice)
    };
  }
  
  async sponsorTransaction(tx: Transaction, userEmail: string): Promise<boolean> {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒååˆ†ãªã‚¹ãƒãƒ³ã‚µãƒ¼ã‚·ãƒƒãƒ—æ®‹é«˜ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    const userBalance = await this.getUserSponsorBalance(userEmail);
    const txCost = await this.estimateTransactionCost(tx);
    
    if (userBalance.gte(txCost.totalCost)) {
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ®‹é«˜ã‹ã‚‰å·®ã—å¼•ã
      await this.deductSponsorBalance(userEmail, txCost.totalCost);
      return true;
    }
    
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¬ã‚¹ãƒ—ãƒ¼ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
    const poolBalance = await this.gasPool.getBalance();
    if (poolBalance.gte(txCost.totalCost)) {
      await this.gasPool.deduct(txCost.totalCost);
      return true;
    }
    
    return false;
  }
}
```

---

## ğŸ”§ æŠ€è¡“é©æ–°

### 1. DKIMãƒ¬ã‚¸ã‚¹ãƒˆãƒªæœ€é©åŒ–

```solidity
contract OptimizedDKIMRegistry {
    // ã‚¬ã‚¹åŠ¹ç‡ã®ãŸã‚ã®ãƒ‘ãƒƒã‚¯æ¸ˆã¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
    struct DKIMKey {
        bytes32 domainHash;     // 32ãƒã‚¤ãƒˆ
        bytes32 selectorHash;   // 32ãƒã‚¤ãƒˆ
        bytes publicKey;        // å¯å¤‰é•·
        uint32 validFrom;       // 4ãƒã‚¤ãƒˆ
        uint32 validUntil;      // 4ãƒã‚¤ãƒˆ
        bool revoked;           // 1ãƒ“ãƒƒãƒˆ
    }
    
    // O(1)ãƒ«ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ãŸã‚ã®ãƒãƒƒãƒ”ãƒ³ã‚°ä½¿ç”¨
    mapping(bytes32 => DKIMKey) public dkimKeys;
    
    // ã‚¬ã‚¹å‰Šæ¸›ã®ãŸã‚ã®ãƒãƒƒãƒã‚­ãƒ¼æ›´æ–°
    function batchUpdateDKIMKeys(
        bytes32[] calldata keyHashes,
        DKIMKey[] calldata keys
    ) external onlyOwner {
        require(keyHashes.length == keys.length, "Length mismatch");
        
        for (uint i = 0; i < keyHashes.length; i++) {
            dkimKeys[keyHashes[i]] = keys[i];
        }
    }
}
```

### 2. è¨¼æ˜æ¤œè¨¼æœ€é©åŒ–

```solidity
// ãƒ—ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ä½¿ç”¨ã—ãŸæœ€é©åŒ–ã•ã‚ŒãŸæ¤œè¨¼
library VerificationOptimizer {
    function verifyGroth16Proof(
        uint[2] memory _pA,
        uint[2][2] memory _pB,
        uint[2] memory _pC,
        uint[4] memory _pubSignals
    ) internal view returns (bool) {
        // ãƒšã‚¢ãƒªãƒ³ã‚°ãƒã‚§ãƒƒã‚¯ã«EIP-197ãƒ—ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆä½¿ç”¨
        uint[24] memory input;
        
        // è¨¼æ˜ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ãƒƒã‚¯
        input[0] = _pA[0];
        input[1] = _pA[1];
        // ... ã™ã¹ã¦ã®è¨¼æ˜è¦ç´ ã‚’ãƒ‘ãƒƒã‚¯
        
        // bn256ãƒšã‚¢ãƒªãƒ³ã‚°ãƒ—ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼ˆã‚¢ãƒ‰ãƒ¬ã‚¹0x08ï¼‰ã‚’å‘¼ã³å‡ºã—
        uint[1] memory result;
        bool success;
        
        assembly {
            success := staticcall(
                sub(gas(), 2000),  // ã‚¬ã‚¹åˆ¶é™
                0x08,              // ãƒ—ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹  
                input,             // å…¥åŠ›ãƒ‡ãƒ¼ã‚¿
                0x300,             // å…¥åŠ›ã‚µã‚¤ã‚ºï¼ˆ24 * 32ãƒã‚¤ãƒˆï¼‰
                result,            // å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿
                0x20               // å‡ºåŠ›ã‚µã‚¤ã‚º
            )
        }
        
        return success && result[0] == 1;
    }
}
```

### 3. ã‚¯ãƒ­ã‚¹ãƒã‚§ãƒ¼ãƒ³å¯¾å¿œ

```typescript
interface CrossChainRelayer {
  // è¤‡æ•°ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆ
  networks: {
    ethereum: NetworkConfig;
    polygon: NetworkConfig;
    arbitrum: NetworkConfig;
    baseSepolia: NetworkConfig;
  };
  
  async bridgeTokens(
    fromChain: string,
    toChain: string,
    token: string,
    amount: string,
    recipient: string
  ): Promise<BridgeTransaction>;
}

class CrossChainManager {
  async handleCrossChainEmail(emailCommand: EmailCommand): Promise<void> {
    // ãƒ¡ãƒ¼ãƒ«ã‹ã‚‰å—ä¿¡è€…ãƒã‚§ãƒ¼ãƒ³è¨­å®šã‚’ãƒ‘ãƒ¼ã‚¹
    // ä¾‹: "alice@gmail.comã«Polygonã§100USDCé€é‡‘"
    const targetChain = this.parseChainPreference(emailCommand.body);
    const currentChain = this.getCurrentChain(emailCommand.token);
    
    if (targetChain !== currentChain) {
      // ã‚¯ãƒ­ã‚¹ãƒã‚§ãƒ¼ãƒ³ãƒ–ãƒªãƒƒã‚¸ã‚’å®Ÿè¡Œ
      await this.bridgeTokens({
        fromChain: currentChain,
        toChain: targetChain,
        amount: emailCommand.amount,
        token: emailCommand.token,
        recipient: emailCommand.recipient
      });
    } else {
      // åŒãƒã‚§ãƒ¼ãƒ³è»¢é€ã‚’å®Ÿè¡Œ
      await this.executeTransfer(emailCommand);
    }
  }
}
```

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹

### ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | å¾“æ¥ã®æš—å·é€šè²¨ | ZK Email Pay | æ”¹å–„ |
|--------|-------------------|--------------|-------------|
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°** | | | |
| åˆå›å–å¼•ã¾ã§ã®æ™‚é–“ | 15-30åˆ† | 30ç§’ | 30-60å€é«˜é€Ÿ |
| å¿…è¦ã‚¹ãƒ†ãƒƒãƒ—æ•° | 12ä»¥ä¸Šã®ã‚¹ãƒ†ãƒƒãƒ— | 2ã‚¹ãƒ†ãƒƒãƒ— | 6å€ã‚·ãƒ³ãƒ—ãƒ« |
| å¿…è¦æŠ€è¡“çŸ¥è­˜ | é«˜ | ãªã— | âˆæ”¹å–„ |
| | | | |
| **å–å¼•ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹** | | | |
| è¨¼æ˜ç”Ÿæˆ | N/A | 2-5ç§’ | æ–°æ©Ÿèƒ½ |
| ã‚¬ã‚¹ä»£ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è² æ‹…ï¼‰ | 100-5000å†† | 0å†† | 100%å‰Šæ¸› |
| ç¢ºèªæ™‚é–“ | 15ç§’-10åˆ† | 30ç§’ | 2-20å€é«˜é€Ÿ |
| | | | |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | | | |
| ç§˜å¯†éµéœ²å‡ºãƒªã‚¹ã‚¯ | é«˜ | ãªã— | âˆæ”¹å–„ |
| ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°è¢«å®³å¯èƒ½æ€§ | é«˜ | ä½ | å¤§å¹…æ”¹å–„ |
| ãƒªã‚«ãƒãƒªè¤‡é›‘æ€§ | éå¸¸ã«é«˜ | ãƒ¡ãƒ¼ãƒ«ãƒªã‚«ãƒãƒª | å¤§å¹…æ”¹å–„ |

### ã‚¬ã‚¹æœ€é©åŒ–çµæœ

```
ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ:
- EmailWalletCore: 210ä¸‡ã‚¬ã‚¹
- UnclaimedFundManager: 180ä¸‡ã‚¬ã‚¹  
- DKIMRegistry: 90ä¸‡ã‚¬ã‚¹
åˆè¨ˆ: 480ä¸‡ã‚¬ã‚¹ï¼ˆ25gweiã€ETH 50ä¸‡å††æ™‚ ç´„24ä¸‡å††ï¼‰

å–å¼•ã‚³ã‚¹ãƒˆ:
- ãƒ¡ãƒ¼ãƒ«ã‚¦ã‚©ãƒ¬ãƒƒãƒˆä½œæˆ: 15ä¸‡ã‚¬ã‚¹
- ZKè¨¼æ˜æ¤œè¨¼: 2.1ä¸‡ã‚¬ã‚¹
- è³‡é‡‘è»¢é€: 6.5ä¸‡ã‚¬ã‚¹
- è³‡é‡‘ã‚¯ãƒ¬ãƒ¼ãƒ : 18ä¸‡ã‚¬ã‚¹

é©ç”¨ã—ãŸæœ€é©åŒ–:
- ãƒ‘ãƒƒã‚¯æ§‹é€ ä½“: 30%ã‚¬ã‚¹å‰Šæ¸›
- ãƒãƒƒãƒã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: 60%ã‚¬ã‚¹å‰Šæ¸›  
- ãƒ—ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆä½¿ç”¨: æ¤œè¨¼ã§80%ã‚¬ã‚¹å‰Šæ¸›
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæœ€é©åŒ–: 25%ã‚¬ã‚¹å‰Šæ¸›
```

---

## ğŸ›¡ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### è„…å¨ãƒ¢ãƒ‡ãƒ« & å¯¾ç­–

#### 1. ãƒ¡ãƒ¼ãƒ«ä¾µå®³æ”»æ’ƒ
```
è„…å¨: æ”»æ’ƒè€…ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹
å¯¾ç­–: 
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ï¼ˆè¿½åŠ ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ï¼‰
- é«˜é¡å–å¼•ã®æ™‚é–“ãƒ­ãƒƒã‚¯
- å¤§é¡ç”¨ã®ãƒãƒ«ãƒãƒ¡ãƒ¼ãƒ«èªè¨¼
- è©æ¬ºæ¤œçŸ¥ã®ãŸã‚ã®ãƒ¡ãƒ¼ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
```

#### 2. DKIMã‚­ãƒ¼ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ”»æ’ƒ
```
è„…å¨: ãƒ‰ãƒ¡ã‚¤ãƒ³æ‰€æœ‰è€…ãŒDKIMã‚­ãƒ¼ã‚’ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦å¤ã„ç½²åã‚’ç„¡åŠ¹åŒ–
å¯¾ç­–:
- DKIMã‚­ãƒ¼å±¥æ­´è¿½è·¡
- å¤ã„ã‚­ãƒ¼ã®çŒ¶äºˆæœŸé–“
- è¤‡æ•°ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å†—é•·æ€§
- ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£é§†å‹•DKIMãƒ¬ã‚¸ã‚¹ãƒˆãƒª
```

#### 3. ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸­å¤®é›†æ¨©ãƒªã‚¹ã‚¯
```
è„…å¨: å˜ä¸€ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå˜ä¸€éšœå®³ç‚¹ã«ãªã‚‹
å¯¾ç­–:
- åˆ†æ•£ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
- è¤‡æ•°ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼ã®çµŒæ¸ˆçš„ã‚¤ãƒ³ã‚»ãƒ³ãƒ†ã‚£ãƒ–
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 
- ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠå¯èƒ½ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­å®š
```

#### 4. ZKå›è·¯ãƒã‚°
```
è„…å¨: ZKå›è·¯ã®ãƒã‚°ãŒç„¡åŠ¹ãªè¨¼æ˜ã‚’è¨±å¯
å¯¾ç­–:
- å›è·¯ã®å½¢å¼çš„æ¤œè¨¼
- è¤‡æ•°ã®ç›£æŸ»ãƒ©ã‚¦ãƒ³ãƒ‰
- ä¾¡å€¤åˆ¶é™ã«ã‚ˆã‚‹æ®µéšçš„ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ
- å›è·¯ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 
```

### ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è¨¼

```
ZK Email PayãŒæ˜ã‹ã™ã‚‚ã®:
âœ… æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚ŒãŸï¼ˆãŸã ã—å†…å®¹ã¯éå…¬é–‹ï¼‰
âœ… å–å¼•ãŒç™ºç”Ÿã—ãŸï¼ˆãŸã ã—é‡‘é¡/å½“äº‹è€…ã¯éå…¬é–‹ï¼‰
âœ… DKIMç½²åãŒæœ‰åŠ¹ï¼ˆãŸã ã—ãƒ¡ãƒ¼ãƒ«è©³ç´°ã¯éå…¬é–‹ï¼‰

ZK Email PayãŒéš ã™ã‚‚ã®:
ğŸ”’ ãƒ¡ãƒ¼ãƒ«å†…å®¹ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
ğŸ”’ å–å¼•é‡‘é¡  
ğŸ”’ é€ä¿¡è€…/å—ä¿¡è€…ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£
ğŸ”’ ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è©³ç´°
ğŸ”’ å–å¼•ãƒ‘ã‚¿ãƒ¼ãƒ³

ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ¬ãƒ™ãƒ«: 
- ã‚ªãƒ³ãƒã‚§ãƒ¼ãƒ³: ã‚¼ãƒ­çŸ¥è­˜
- ã‚ªãƒ•ãƒã‚§ãƒ¼ãƒ³: ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ¬ãƒ™ãƒ«
- ç›¸äº’å‚ç…§: ç›¸é–¢æ”»æ’ƒã«è€æ€§
```

---

## ğŸš€ ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£è§£æ±ºç­–

### Layer 2çµ±åˆ

```typescript
// ãƒãƒ«ãƒãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæˆ¦ç•¥
const deploymentStrategy = {
  layer1: {
    chain: 'ethereum',
    contracts: ['DKIMRegistry', 'EmailWalletCore'],
    role: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ³ã‚«ãƒ¼ã€æœ€çµ‚æ±ºæ¸ˆ'
  },
  
  layer2: {
    chains: ['polygon', 'arbitrum', 'optimism', 'base'],
    contracts: ['UnclaimedFundManager', 'TokenBridge'],
    role: 'é«˜é€Ÿãƒ»å®‰ä¾¡å–å¼•'
  },
  
  sidechains: {
    chains: ['baseSepolia', 'polygonMumbai'],
    contracts: ['All contracts'],
    role: 'ãƒ†ã‚¹ãƒˆãƒ»é–‹ç™º'
  }
};
```

### æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         â”‚         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
â”‚ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼1 â”‚ â”‚ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼2â”‚ â”‚ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼Nâ”‚
â”‚(US-æ±)    â”‚ â”‚(EU-è¥¿)   â”‚ â”‚(APAC)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚         â”‚         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  å…±æœ‰ZKè¨¼æ˜       â”‚
        â”‚  ç”Ÿæˆãƒ—ãƒ¼ãƒ«        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹äºˆæ¸¬

```
ç¾åœ¨ã®å®¹é‡ï¼ˆå˜ä¸€ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰:
- 100ãƒ¡ãƒ¼ãƒ«/åˆ†å‡¦ç†
- 50ZKè¨¼æ˜/åˆ†ç”Ÿæˆ  
- 1000å–å¼•/æ™‚å®Ÿè¡Œ

ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ç›®æ¨™:
- å…¨ä¸–ç•Œ1000ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼
- 10ä¸‡ãƒ¡ãƒ¼ãƒ«/åˆ†å‡¦ç†
- 5ä¸‡è¨¼æ˜/åˆ†ç”Ÿæˆ
- 100ä¸‡å–å¼•/æ™‚å®Ÿè¡Œ

ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æ:
1. ZKè¨¼æ˜ç”Ÿæˆ: æœ€é«˜ã‚³ã‚¹ãƒˆï¼ˆä¸¦åˆ—åŒ–å¯èƒ½ï¼‰
2. ãƒ¡ãƒ¼ãƒ«å‡¦ç†: ä¸­ã‚³ã‚¹ãƒˆï¼ˆç°¡å˜ã«ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
3. ã‚¬ã‚¹ä»£ç®¡ç†: ä½ã‚³ã‚¹ãƒˆï¼ˆãƒ—ãƒ¼ãƒ«åŒ–å¯èƒ½ï¼‰
4. å–å¼•ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ: æœ€ä½ã‚³ã‚¹ãƒˆï¼ˆãƒãƒƒãƒåŒ–å¯èƒ½ï¼‰
```

---

## ğŸ”® æŠ€è¡“ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### ãƒ•ã‚§ãƒ¼ã‚º1: ã‚³ã‚¢ã‚¤ãƒ³ãƒ•ãƒ©ï¼ˆå®Œäº†ï¼‰
- âœ… ãƒ¡ãƒ¼ãƒ«æ¤œè¨¼ã®åŸºæœ¬ZKå›è·¯
- âœ… Base Sepoliaã¸ã®ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤
- âœ… å˜ä¸€ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼å®Ÿè£…
- âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆãƒ•ã‚©ãƒ¼ã‚»ãƒƒãƒˆã€é€é‡‘ã€ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º2: æœ¬ç•ªç’°å¢ƒå¼·åŒ–ï¼ˆä»Šå¾Œ3ãƒ¶æœˆï¼‰  
- ğŸ”„ ãƒãƒ«ãƒãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
- ğŸ”„ é«˜åº¦ãªZKå›è·¯ï¼ˆãƒãƒƒãƒæ¤œè¨¼ï¼‰
- ğŸ”„ ã‚¯ãƒ­ã‚¹ãƒã‚§ãƒ¼ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ãƒ–ãƒªãƒƒã‚¸
- ğŸ”„ ä¼æ¥­APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º3: é«˜åº¦æ©Ÿèƒ½ï¼ˆ3-6ãƒ¶æœˆï¼‰
- ğŸ“‹ ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ–ãƒ«ãƒ¡ãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰
- ğŸ“‹ DeFiçµ±åˆï¼ˆè²¸å€Ÿï¼‰
- ğŸ“‹ ãƒ¡ãƒ¼ãƒ«çµŒç”±NFTã‚µãƒãƒ¼ãƒˆ
- ğŸ“‹ ãƒ¡ãƒ¼ãƒ«çµ±åˆãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª

### ãƒ•ã‚§ãƒ¼ã‚º4: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆ6-12ãƒ¶æœˆï¼‰
- ğŸ“‹ ãƒãƒ«ãƒãƒã‚§ãƒ¼ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ10ä»¥ä¸Šã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰
- ğŸ“‹ ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—  
- ğŸ“‹ è¦åˆ¶ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- ğŸ“‹ æ©Ÿé–¢æŠ•è³‡å®¶ã‚«ã‚¹ãƒˆãƒ‡ã‚£çµ±åˆ

---

## ğŸ‡¯ğŸ‡µ æ—¥æœ¬å¸‚å ´å‘ã‘æŠ€è¡“ç‰¹åŒ–

### æ—¥æœ¬èªè‡ªç„¶è¨€èªå‡¦ç†

```typescript
class JapaneseCommandParser {
  private patterns = {
    // ç¢ºèªç³»
    confirm: [/ç¢ºèª/, /æ‰¿èª/, /ãŠã‘/, /ã¯ã„/, /ã‚ˆã‚ã—ã„/, /äº†è§£/],
    
    // é€é‡‘ç³»
    send: [
      /(.+)ã«(\d+\.?\d*)(\w+)é€ã£ã¦/,
      /(\d+\.?\d*)(\w+)ã‚’(.+)ã«/,
      /(.+)ã¸(\d+\.?\d*)(\w+)/
    ],
    
    // æ‹’å¦ç³»
    reject: [/ã„ã„ãˆ/, /ã ã‚/, /æ‹’å¦/, /ã‚­ãƒ£ãƒ³ã‚»ãƒ«/, /ã‚„ã‚ã¦/]
  };
  
  parseCommand(emailBody: string): Command {
    // æ—¥æœ¬èªã®æ›–æ˜§æ€§ã‚’è€ƒæ…®ã—ãŸæŸ”è»Ÿãªãƒ‘ãƒ¼ã‚¹
    const body = this.normalizeJapanese(emailBody);
    
    // ç¢ºèªã‚³ãƒãƒ³ãƒ‰æ¤œå‡º
    if (this.patterns.confirm.some(pattern => pattern.test(body))) {
      return { type: 'CONFIRM', params: {} };
    }
    
    // é€é‡‘ã‚³ãƒãƒ³ãƒ‰æ¤œå‡º
    for (const pattern of this.patterns.send) {
      const match = body.match(pattern);
      if (match) {
        return this.buildSendCommand(match);
      }
    }
    
    return { type: 'UNKNOWN', params: {} };
  }
}
```

### æ—¥æœ¬ã®é‡‘èè¦åˆ¶å¯¾å¿œ

```solidity
contract JapanComplianceModule {
    // æš—å·è³‡ç”£äº¤æ›æ¥­è€…å¯¾å¿œ
    mapping(address => bool) public approvedExchanges;
    
    // æœ¬äººç¢ºèªãƒ¬ãƒ™ãƒ«
    enum KYCLevel {
        None,        // 0å††
        Basic,       // ~10ä¸‡å††/æœˆ
        Advanced,    // ~100ä¸‡å††/æœˆ
        Premium      // åˆ¶é™ãªã—
    }
    
    mapping(bytes32 => KYCLevel) public emailKYCLevel;
    
    function setTransactionLimits(
        bytes32 emailHash,
        KYCLevel level
    ) external onlyApprovedExchange {
        emailKYCLevel[emailHash] = level;
    }
    
    function getMonthlyLimit(bytes32 emailHash) public view returns (uint256) {
        KYCLevel level = emailKYCLevel[emailHash];
        
        if (level == KYCLevel.None) return 0;
        if (level == KYCLevel.Basic) return 100000 * 10**6; // 10ä¸‡å††ç›¸å½“USDC
        if (level == KYCLevel.Advanced) return 1000000 * 10**6; // 100ä¸‡å††ç›¸å½“
        
        return type(uint256).max; // åˆ¶é™ãªã—
    }
}
```

### æ—¥æœ¬ã®ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼çµ±åˆ

```typescript
interface JapaneseEmailProviders {
  docomo: DocomoEmailIntegration;
  yahoo: YahooEmailIntegration;
  gmail: GmailIntegration;
  outlook: OutlookIntegration;
}

class DocomoEmailIntegration implements EmailProvider {
  // ãƒ‰ã‚³ãƒ¢ãƒ¡ãƒ¼ãƒ«ç‰¹æœ‰ã®DKIMè¨­å®š
  async getDKIMPublicKey(selector: string): Promise<string> {
    return await this.fetchFromDocomoAPI(`dkim/${selector}`);
  }
  
  // ã‚­ãƒ£ãƒªã‚¢æ±ºæ¸ˆã¨ã®çµ±åˆ
  async integrateCarrierBilling(
    userEmail: string,
    amount: number
  ): Promise<BillingResponse> {
    return await this.docomoCarrierBilling.charge({
      email: userEmail,
      amount: amount,
      description: 'ZK Email Pay ãƒˆãƒƒãƒ—ã‚¢ãƒƒãƒ—'
    });
  }
}
```

---

## ğŸ’¡ æ—¥æœ¬ç‹¬è‡ªã®æŠ€è¡“é©æ–°

### 1. FeliCa/ãŠã‚µã‚¤ãƒ•ã‚±ãƒ¼ã‚¿ã‚¤çµ±åˆ
```typescript
class FeliCaIntegration {
  async linkFeliCaToEmail(
    feliCaId: string,
    emailAddress: string
  ): Promise<void> {
    // FeliCaã‚«ãƒ¼ãƒ‰IDã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç´ä»˜ã‘
    const linkingProof = await this.generateLinkingProof(feliCaId, emailAddress);
    await this.storeSecureLink(linkingProof);
  }
  
  async tapToConfirm(feliCaId: string): Promise<boolean> {
    // ã‚¿ãƒƒãƒ—ã§å–å¼•ç¢ºèª
    const linkedEmail = await this.getLinkedEmail(feliCaId);
    return await this.autoConfirmTransaction(linkedEmail);
  }
}
```

### 2. QRã‚³ãƒ¼ãƒ‰æ±ºæ¸ˆçµ±åˆ
```typescript
class QRPaymentIntegration {
  generateEmailPaymentQR(
    recipientEmail: string,
    amount: number,
    token: string
  ): string {
    // ãƒ¡ãƒ¼ãƒ«æ±ºæ¸ˆç”¨QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
    const paymentData = {
      type: 'zk-email-pay',
      recipient: recipientEmail,
      amount: amount,
      token: token,
      timestamp: Date.now()
    };
    
    return this.generateQR(JSON.stringify(paymentData));
  }
  
  async scanAndPay(qrData: string): Promise<PaymentResponse> {
    const payment = JSON.parse(qrData);
    
    // è‡ªå‹•çš„ã«ãƒ¡ãƒ¼ãƒ«é€ä¿¡
    return await this.sendPaymentEmail({
      to: payment.recipient,
      amount: payment.amount,
      token: payment.token
    });
  }
}
```

### 3. LINE/WeChaté¢¨ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆçµ±åˆ
```typescript
class ChatBotIntegration {
  async handleChatCommand(
    userId: string,
    message: string
  ): Promise<ChatResponse> {
    const command = this.parseChatCommand(message);
    
    switch (command.type) {
      case 'BALANCE_CHECK':
        return await this.getBalanceResponse(userId);
        
      case 'SEND_MONEY':
        return await this.initiateSendFlow(userId, command.params);
        
      case 'TRANSACTION_HISTORY':
        return await this.getHistoryResponse(userId);
        
      default:
        return this.getHelpResponse();
    }
  }
  
  private parseChatCommand(message: string): Command {
    // ã€Œæ®‹é«˜æ•™ãˆã¦ã€ã€Œç”°ä¸­ã•ã‚“ã«1000å††é€ã£ã¦ã€ç­‰ã‚’è§£æ
    if (message.includes('æ®‹é«˜')) {
      return { type: 'BALANCE_CHECK', params: {} };
    }
    
    const sendMatch = message.match(/(.+)ã«(\d+)å††é€ã£ã¦/);
    if (sendMatch) {
      return {
        type: 'SEND_MONEY',
        params: {
          recipient: sendMatch[1],
          amount: sendMatch[2]
        }
      };
    }
    
    return { type: 'UNKNOWN', params: {} };
  }
}
```

è¦šãˆã¦ãŠã„ã¦: **ã€Œæœ€é«˜ã®æŠ€è¡“ã¯è¦‹ãˆãªã„æŠ€è¡“ã€** - ç§ãŸã¡ã®æˆåŠŸã¯ã€ZKè¨¼æ˜ãŒã„ã‹ã«å°è±¡çš„ã‹ã§ã¯ãªãã€ãŠã°ã‚ã¡ã‚ƒã‚“ãŒã„ã‹ã«ç°¡å˜ã«æš—å·é€šè²¨ã‚’ä½¿ãˆã‚‹ã‹ã§æ¸¬ã‚‰ã‚Œã¾ã™ã€‚

---

## ğŸŒ ã¾ã¨ã‚: æ—¥æœ¬ç™ºä¸–ç•Œæ¨™æº–ã¸

### ãªãœæ—¥æœ¬ã‹ã‚‰å§‹ã‚ã‚‹ã®ã‹
1. **é«˜ã„æŠ€è¡“æ¨™æº–**: å“è³ªã¸ã®æ‹˜ã‚Š
2. **è¦åˆ¶ã®æ˜ç¢ºæ€§**: æš—å·è³‡ç”£æ³•ã®æ•´å‚™
3. **é«˜é½¢åŒ–èª²é¡Œ**: è§£æ±ºã§ãã‚Œã°ä¸–ç•Œã§é€šç”¨
4. **ãƒ¡ãƒ¼ãƒ«æ–‡åŒ–**: ä¸–ä»£ã‚’è¶…ãˆãŸåˆ©ç”¨

### ã‚°ãƒ­ãƒ¼ãƒãƒ«å±•é–‹æˆ¦ç•¥
1. **æ—¥æœ¬ã§å®Œç’§ã«ã™ã‚‹**
2. **ã‚¢ã‚¸ã‚¢å¤ªå¹³æ´‹ã«å±•é–‹**
3. **æ¬§ç±³å¸‚å ´ã«å‚å…¥**
4. **æ–°èˆˆå›½ã§é‡‘èåŒ…æ‘‚å®Ÿç¾**

**ZK Email Pay: æ—¥æœ¬ã®ã€ŒãŠã‚‚ã¦ãªã—ã€ã‚’Web3ã«**