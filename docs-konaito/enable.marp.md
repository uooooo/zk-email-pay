---
marp: true
title: Email Wallet 操作ガイド（ユーザー向け）
description: メールだけで暗号資産を送受金するための手順と注意点
paginate: true
theme: default
class: lead
---

# Email Wallet 操作ガイド

- 対象: Email Wallet を使って送受金するエンドユーザー
- バージョン: v0.1 / 2025-09-14
- この資料はメールの件名（Subject）で操作する基本と注意点をまとめています。

---

## できること（概要）

- 送金（ETH/対応 ERC20）
  - 宛先: メールアドレス または Ethereum アドレス
- 受取（未請求残高のクレーム）
- 手数料支払い: ETH/WETH/DAI/USDC のいずれか
- 拡張機能の利用
  - Uniswap スワップ、NFT 送付 など
- 高度操作: 任意コールデータの実行（Execute）
- 設定: DKIM Registry 切替 / 所有権移管（Exit）

---

## 前提と用語

- Relayer: あなたのメールを受け取り、ZK 証明を生成してチェーンへ投稿するサービス
- Token Registry: 利用できるトークン名 ↔ アドレスの台帳
- 未請求残高（Unclaimed Fund）: メール宛送金時に、受取人が後でクレームする残高
- ウォレット: あなた専用のコントラクトウォレット（初回メールで自動作成される場合あり）

---

## 対応トークン（重要）

- 送金に使えるトークンは Token Registry に登録されたもののみ。
- 既定でサポート: ETH(=WETH), DAI, USDC。
- 手数料として使えるのは ETH/WETH/DAI/USDC のみ。
- それ以外の ERC20 は、管理者がレジストリ登録すれば利用可能。

> 「なんでも ERC20 可」ではありません。未登録トークンは失敗します。

---

## 送金（メールアドレス宛）

- 件名例: `Send 1 DAI to friend@example.com`
- 処理: あなたのウォレットから一旦「未請求残高」に移され、受取人が後でクレームします。
- 送信時にリレイヤー手数料がかかります（支払トークン: ETH/WETH/DAI/USDC）。

---

## 送金（アドレス宛）

- 件名例: `Send 0.2 ETH to 0xAbC123...`
- ETH の場合: 内部的に WETH → ETH へアンラップして送金されます。
- ERC20 の場合: 指定トークンを直接転送します（要レジストリ登録）。

---

## 受取（未請求残高のクレーム）

- 受取人はガイドに従い、招待/通知メールから自分のウォレットを初期化し、残高をクレームします。
- 一定期間内（デプロイ設定）に未クレームの場合、送金者へ返還される設計が可能です。

---

## 手数料の考え方

- 手数料通貨: ETH/WETH/DAI/USDC のみ。
- リレー実費（ガス）+ 処理固定分 ≈ 手数料として徴収。
- 料金換算はオンチェーンのオラクル/レートを使用（未対応トークンは失敗）。
- メールの有効期限: 署名時刻から有効期間内のみ有効（期限切れは無効）。

---

## Uniswap スワップ（拡張）

- 例1: `Swap 1 ETH to DAI`
- 例2: `Swap 1 DAI to USDC with 0.5 slippage`
- 例3: `Swap 1 DAI to USDC under 792281625... sqrt price limit`
- 条件:
  - 入出力トークンがレジストリ登録済み
  - プールが存在するか、存在しない場合は WETH を経由
  - 受取は自分のウォレット（メール宛受取は不可）

---

## 拡張のインストール/削除

- 追加: `Install extension Uniswap`
- 削除: `Uninstall extension Uniswap`
- 拡張はコマンドごとに紐づき、件名テンプレートで動作します。

---

## 任意コールデータの実行（上級者向け）

- 件名: `Execute 0x<calldata>`
- 実行対象・送付 ETH 量・データの ABI は、フロントエンドやガイドに従って準備してください。
- 失敗時は理由が返り、手数料は発生する場合があります。

---

## DKIM Registry の設定

- 件名: `DKIM registry set to 0x...`
- 自前の DKIM Registry を使うことで、より厳格な制御が可能です。

---

## ウォレット所有権の移管（Exit）

- 件名: `Exit Email Wallet. Set owner to 0x...`
- 新しいオーナー（EOA）に権限を移し、任意コール実行などを委譲します。

---

## エラーになりやすいポイント

- 件名の厳密一致: テンプレと完全一致しないと失敗。
- 未登録トークン: Token Registry に無いトークン名は失敗。
- 手数料通貨ミス: ETH/WETH/DAI/USDC 以外は不可。
- 有効期限切れ: メール署名の時刻が有効期間外。
- 受取タイプ不整合: メール宛とアドレス宛を同時指定は不可。

---

## プライバシーと安全性

- メールアドレス等の秘密情報は ZK 証明によりオンチェーンへ直接公開されません。
- ただし特定額のスキャンなどにより、相手が推測し得るリスクはあります。
- Relayer が登録済み/正当であること、DKIM が改ざんされていないことが前提です。

---

## よくある質問（FAQ）

- Q: 任意の ERC20 を送れますか？
  - A: Token Registry に登録済みのみ。未登録は不可。
- Q: 手数料は USDT で払えますか？
  - A: いいえ。ETH/WETH/DAI/USDC のみ。
- Q: 受取の方法は？
  - A: 招待/通知メールの手順に従い、ウォレット初期化後にクレームします。

---

## 参考

- プロジェクト同梱ドキュメント
  - `email-wallet/README.md` / `email-wallet/DESIGN.md`
  - `email-wallet/packages/contracts`（TokenRegistry, EmailWalletCore, Extensions）
  - `email-wallet/packages/relayer/README.md`

---

## 変更履歴

- v0.1 (2025-09-14)
  - 初版作成（対応トークン/操作/エラー/拡張を整理）

