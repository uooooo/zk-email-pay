# セキュリティ/プライバシー/脅威モデル

参照: `docs/zkemail/zk-email-overview.md`（章8）、`docs/zkemail/zkemail-architecture/*`。

## 主要リスクと対策
- メール乗っ取り/なりすまし
  - DKIM検証のZK化（`email_sender.circom`）。送信ドメインを許可リストで制限可。
  - 高額/異常時は追加確認（2FA/二重メール/遅延解除）。
- DKIM鍵のすり替え/キャッシュ汚染
  - 信頼済みフェッチャ＋ピン留め/キャッシュ。将来DNSSEC/独自Registry（ECDSAOwnedDKIMRegistry）。
- リプレイ/重複請求
  - `nonce`/`expiry`/`email_nullifier` を回路/コントラクトで強制。Unclaimed消費時に不可逆。
- フィッシング/ドメイン偽装
  - 通知メールのドメイン表記を明確化、偽装検知チップ、サポート導線。マジックリンクは短命/単回。
- パース差異/実装ずれ
  - 仕様準拠の正規化テスト（ヘッダ/本文のcanonicalization）。
- DoS/スパム
  - レート制御（メール/IP/トークン別）、最大同時証明、キュー、超過は段階的制限。
- プライバシー
  - メールアドレスはオンチェーン非開示（コミット/ポインタ）。オフチェーンはハッシュ保管。ログの秘匿化/保持期間短縮。

## 権限/鍵管理
- Relayer 秘密鍵（送信/署名）をHSM/KMSに格納。ローテーション/監査ログ。
- SMTP 資格情報はSecrets管理。

## 監査/可観測性
- 重要イベント（Unclaimed作成/消費/取消、Proof失敗、DKIM失敗）をメトリクス化してアラート。

## 法務・コンプライアンス（MVP方針）
- 小額向け上限/地域制限/KYC方針の整理。ブラックリスト/制裁リストのオフチェーン照合（必要時）。

